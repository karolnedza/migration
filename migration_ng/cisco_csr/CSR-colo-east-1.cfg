 hostname East1-Colo
 username admin privilege 15
!
 interface GigabitEthernet2
  ip address dhcp
  no shut
!
 ip ssh pubkey-chain
  username admin
   key-hash ssh-rsa 292FA9C631892100B28C1C5BAFEA12A3 admin
!
! --------------------------------------------------------------------------------
! AWS tunnels
! --------------------------------------------------------------------------------
! IPSec Tunnel #1 (Primary)
! --------------------------------------------------------------------------------
! #1: Internet Key Exchange (IKE) Configuration
! A policy is established for the supported ISAKMP encryption, 
! authentication, Diffie-Hellman, lifetime, and key parameters.
!
crypto keyring 54.225.56.173-34.192.228.18
  pre-shared-key address 34.192.228.18 key LxTnuN1kjZKtnfTrcYuLaw6HMyORTfp5eATMIr3n
!
crypto isakmp policy 1
 encryption aes 256
 authentication pre-share
 hash sha256
 group 14
 lifetime 28800
crypto isakmp keepalive 10 3 periodic
crypto isakmp profile 54.225.56.173-34.192.228.18
   keyring 54.225.56.173-34.192.228.18
   self-identity address
   match identity address 34.192.228.18 255.255.255.255
!
!---------------------------------------------------------------------------------
! #2: IPSec Configuration
! The IPSec transform set defines the encryption, authentication, and IPSec
! mode parameters.
!
crypto ipsec transform-set 54.225.56.173-34.192.228.18 esp-aes 256 esp-sha256-hmac
 mode tunnel
crypto ipsec df-bit clear
!
crypto ipsec profile 54.225.56.173-34.192.228.18
 set security-association lifetime seconds 3600
 set transform-set 54.225.56.173-34.192.228.18
 set pfs group14
 set isakmp-profile 54.225.56.173-34.192.228.18
!
!---------------------------------------------------------------------------------------
! #3: Tunnel Interface Configuration
! The virtual tunnel interface is used to communcate with the remote IPSec endpoint 
! to establish the IPSec tunnel.
!
interface Tunnel 1
 ip address 169.254.44.213 255.255.255.252
 ip mtu 1436
 ip tcp adjust-mss 1387
 tunnel source gigabitEthernet 1
 tunnel mode ipsec ipv4
 tunnel destination 34.192.228.18
 tunnel protection ipsec profile 54.225.56.173-34.192.228.18
 ip virtual-reassembly
!
!
! --------------------------------------------------------------------------------
! IPSec Tunnel #2 ( AWS Backup)
! --------------------------------------------------------------------------------
! #4: Internet Key Exchange (IKE) Configuration
!
crypto keyring 54.225.56.173-18.211.132.254
  pre-shared-key address 18.211.132.254 key LxTnuN1kjZKtnfTrcYuLaw6HMyORTfp5eATMIr3n
!
crypto isakmp profile 54.225.56.173-18.211.132.254
   keyring 54.225.56.173-18.211.132.254
   self-identity address
   match identity address 18.211.132.254 255.255.255.255
!
!
!---------------------------------------------------------------------------------
! #5: IPSec Configuration
! The IPSec transform set defines the encryption, authentication, and IPSec
! mode parameters.
!
crypto ipsec transform-set 54.225.56.173-18.211.132.254 esp-aes 256 esp-sha256-hmac
 mode tunnel
!
crypto ipsec profile 54.225.56.173-18.211.132.254
 set security-association lifetime seconds 3600
 set transform-set 54.225.56.173-18.211.132.254
 set pfs group14
 set isakmp-profile 54.225.56.173-18.211.132.254
!
!---------------------------------------------------------------------------------------
! #6: Tunnel Interface Configuration
! The virtual tunnel interface is used to communcate with the remote IPSec endpoint
! to establish the IPSec tunnel.
!
interface Tunnel 2
 ip address 169.254.58.77 255.255.255.252
 ip mtu 1436
 ip tcp adjust-mss 1387
 tunnel source gigabitEthernet 1
 tunnel mode ipsec ipv4
 tunnel destination 18.211.132.254
 tunnel protection ipsec profile 54.225.56.173-18.211.132.254
 ip virtual-reassembly
!
!---------------------------------------------------------------------------------
! Azure tunnels
! --------------------------------------------------------------------------------
! IPSec Tunnel #1 (Primary)
!--------------------------------------------------------------------------------
! #1: Internet Key Exchange (IKE) Configuration
! A policy is established for the supported ISAKMP encryption, 
! authentication, Diffie-Hellman, lifetime, and key parameters.
!
crypto keyring 54.225.56.173-52.155.44.138
  pre-shared-key address 52.155.44.138 key LxTnuN1kjZKtnfTrcYuLaw6HMyORTfp5eATMIr3n
!
crypto isakmp profile 54.225.56.173-52.155.44.138
   keyring 54.225.56.173-52.155.44.138
   self-identity address
   match identity address 52.155.44.138 255.255.255.255
!
!---------------------------------------------------------------------------------
! #2: IPSec Configuration
! The IPSec transform set defines the encryption, authentication, and IPSec
! mode parameters.
!
crypto ipsec transform-set 54.225.56.173-52.155.44.138 esp-aes 256 esp-sha256-hmac
 mode tunnel
!
crypto ipsec profile 54.225.56.173-52.155.44.138
 set security-association lifetime seconds 3600
 set transform-set 54.225.56.173-52.155.44.138
 set pfs group14
 set isakmp-profile 54.225.56.173-52.155.44.138
!
!---------------------------------------------------------------------------------------
! #3: Tunnel Interface Configuration
! The virtual tunnel interface is used to communcate with the remote IPSec endpoint 
! to establish the IPSec tunnel.
!
interface Tunnel 11
 ip address 169.254.169.153 255.255.255.252
 ip mtu 1436
 ip tcp adjust-mss 1387
 tunnel source gigabitEthernet 1
 tunnel mode ipsec ipv4
 tunnel destination 52.155.44.138
 tunnel protection ipsec profile 54.225.56.173-52.155.44.138
 ip virtual-reassembly
!
! --------------------------------------------------------------------------------
! IPSec Tunnel #2 (Azure Backup)
! --------------------------------------------------------------------------------
! #4: Internet Key Exchange (IKE) Configuration
!
crypto keyring 54.225.56.173-20.184.240.251
  pre-shared-key address 20.184.240.251 key LxTnuN1kjZKtnfTrcYuLaw6HMyORTfp5eATMIr3n
!
crypto isakmp profile 54.225.56.173-20.184.240.251
   keyring 54.225.56.173-20.184.240.251
   self-identity address
   match identity address 20.184.240.251 255.255.255.255
!
!
!---------------------------------------------------------------------------------
! #5: IPSec Configuration
! The IPSec transform set defines the encryption, authentication, and IPSec
! mode parameters.
!
crypto ipsec transform-set 54.225.56.173-20.184.240.251 esp-aes 256 esp-sha256-hmac
 mode tunnel
!
crypto ipsec profile 54.225.56.173-20.184.240.251
 set security-association lifetime seconds 3600
 set transform-set 54.225.56.173-20.184.240.251
 set pfs group14
 set isakmp-profile 54.225.56.173-20.184.240.251
!
!---------------------------------------------------------------------------------------
! #6: Tunnel Interface Configuration
! The virtual tunnel interface is used to communcate with the remote IPSec endpoint
! to establish the IPSec tunnel.
!
interface Tunnel 12
 ip address 169.254.80.229 255.255.255.252
 ip mtu 1436
 ip tcp adjust-mss 1387
 tunnel source gigabitEthernet 1
 tunnel mode ipsec ipv4
 tunnel destination 20.184.240.251
 tunnel protection ipsec profile 54.225.56.173-20.184.240.251
 ip virtual-reassembly
!
!---------------------------------------------------------------------------------
! Colo West 2 CSR tunnel
! --------------------------------------------------------------------------------
! IPSec Tunnel #1
! --------------------------------------------------------------------------------
!
crypto keyring colo2
  pre-shared-key address 52.13.154.30 key LxTnuN1kjZKtnfTrcYuLaw6HMyORTfp5eATMIr3n
!
crypto isakmp profile colo2
   keyring colo2
   self-identity address
   match identity address 52.13.154.30 255.255.255.255
   match identity address 172.25.85.248 255.255.255.255
!
!---------------------------------------------------------------------------------
! #2: IPSec Configuration
! The IPSec transform set defines the encryption, authentication, and IPSec
! mode parameters.
!
crypto ipsec transform-set colo2 esp-aes 256 esp-sha256-hmac
 mode tunnel
!
crypto ipsec profile colo2
 set security-association lifetime seconds 3600
 set transform-set colo2
 set pfs group14
 set isakmp-profile colo2
!
!---------------------------------------------------------------------------------------
! #3: Tunnel Interface Configuration
! The virtual tunnel interface is used to communcate with the remote IPSec endpoint 
! to establish the IPSec tunnel.
!
interface Tunnel 21
 ip address 169.254.1.1 255.255.255.252
 ip mtu 1436
 ip tcp adjust-mss 1387
 tunnel source gigabitEthernet 1
 tunnel mode ipsec ipv4
 tunnel destination 52.13.154.30
 tunnel protection ipsec profile colo2
 ip virtual-reassembly
!
!---------------------------------------------------------------------------------------
! #7: BGP Routing Configuration
! The Border Gateway Protocol (BGPv4) is used to exchange routes from the VPC to on-prem
! network. Each BGP router has an Autonomous System Number (ASN).
!
router bgp 65444
 bgp log-neighbor-changes
!
! AWS
!
 neighbor 169.254.44.214 remote-as 65555
 neighbor 169.254.44.214 timers 10 30 30
 neighbor 169.254.58.78 remote-as 65555
 neighbor 169.254.58.78 timers 10 30 30
!
! Azure
!
 neighbor 169.254.169.154 remote-as 65333
 neighbor 169.254.169.154 timers 10 30 30
 neighbor 169.254.80.230 remote-as 65333
 neighbor 169.254.80.230 timers 10 30 30
!
! West 2 CSR
!
 neighbor 169.254.1.2 remote-as 65777
! 
 address-family ipv4
  redistribute connected
  network 172.16.0.0
!  aggregate-address 172.16.0.0 255.255.0.0 summary-only
!  
! AWS
!
  neighbor 169.254.44.214 activate
  neighbor 169.254.44.214 soft-reconfiguration inbound
  neighbor 169.254.44.214 prefix-list default out
  neighbor 169.254.58.78 activate
  neighbor 169.254.58.78 soft-reconfiguration inbound
  neighbor 169.254.58.78 prefix-list default out
!  
! Azure
!
  neighbor 169.254.169.154 activate
  neighbor 169.254.169.154 soft-reconfiguration inbound
  neighbor 169.254.169.154 prefix-list default out
  neighbor 169.254.80.230 activate
  neighbor 169.254.80.230 soft-reconfiguration inbound
  neighbor 169.254.80.230 prefix-list default out
!
! West 2 CSR
!
  neighbor 169.254.1.2 activate
  neighbor 169.254.1.2 soft-reconfiguration inbound
  neighbor 169.254.1.2 prefix-list default out
!  
  maximum-paths 4
 exit-address-family
!
ip prefix-list default seq 5 deny 0.0.0.0/0
ip prefix-list default seq 10 permit 0.0.0.0/0 ge 8
